<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no">
    <title>Simple Dialog App</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: yellow;
        }

        #openDialog {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        .dialog-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .dialog-btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        .dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 20px;
            right: 20px;
            height: 100%;

            /* width: 100dvw; */
            height: 100svh;

            background-color: white;
            border: 4px solid green;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .dialog.open {
            display: block;
        }

        .dialog-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .app {
            height: 80%;
            background-color: red;
            overflow: hidden;
        }

        #log {
            /** Make sure to wrap text in all ways possible: */
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    </style>
</head>

<body>

    <div class="app">

        <div class="dialog-buttons">
            <button class="dialog-btn" data-height-unit="vh">Open Dialog (vh)</button>
            <button class="dialog-btn" data-height-unit="svh">Open Dialog (svh)</button>
            <button class="dialog-btn" data-height-unit="lvh">Open Dialog (lvh)</button>
            <button class="dialog-btn" data-height-unit="dvh">Open Dialog (dvh)</button>
            <button class="dialog-btn" data-height-unit="vb">Open Dialog (vb)</button>
            <button class="dialog-btn" data-height-unit="svb">Open Dialog (svb)</button>
            <button class="dialog-btn" data-height-unit="lvb">Open Dialog (lvb)</button>
            <button class="dialog-btn" data-height-unit="dvb">Open Dialog (dvb)</button>
            <button id="jsHeightBtn" class="dialog-btn">Open Dialog (JS visualViewport.height)</button>
        </div>

        <p>Paragraph 11</p>

        <p>Paragraph 2</p>

        <p>Paragraph 3</p>

        <p>Paragraph 4</p>

        <p>Paragraph 5</p>

        <p>Paragraph 6</p>

        <p>Paragraph 7</p>

    </div>

    <div id="dialog" class="dialog">
        <input type="text" placeholder="Enter text here..." class="dialog-input">
        <div id="log"></div>
    </div>

    <script>
        const dialogBtns = document.querySelectorAll('.dialog-btn');
        const jsHeightBtn = document.getElementById('jsHeightBtn');
        const dialog = document.getElementById('dialog');
        let dialogOpen = false;
        let currentHeightUnit = 'svh';
        let useJsHeight = false;

        // Function to update app height based on visual viewport
        function updateAppHeight() {
            if (window.visualViewport && dialogOpen) {
                // const height = window.visualViewport.height;
                // const width = window.visualViewport.width;

                // dialog.style.height = `${height}px`;
                const height = window.visualViewport.height;
                
                // If using JS height mode, update the dialog height dynamically
                if (useJsHeight) {
                    dialog.style.height = `${height}px`;
                }
                
                // Get dialog element dimensions and properties
                const dialogRect = dialog.getBoundingClientRect();
                const computedStyle = window.getComputedStyle(dialog);
                
                const logData = {
                    heightUnit: useJsHeight ? 'JS (visualViewport.height px)' : currentHeightUnit,
                    visualViewport: {
                        height: window.visualViewport.height,
                        offsetTop: window.visualViewport.offsetTop
                    },
                    dialogElement: {
                        clientHeight: dialog.clientHeight,
                        offsetHeight: dialog.offsetHeight,
                        scrollHeight: dialog.scrollHeight
                    },
                    boundingRect: {
                        height: dialogRect.height,
                        top: dialogRect.top,
                        bottom: dialogRect.bottom
                    },
                    computedStyle: {
                        height: computedStyle.height,
                        display: computedStyle.display,
                        position: computedStyle.position,
                        top: computedStyle.top
                    }
                };
                
                document.getElementById('log').innerText = 'Dialog Element Info:\n' + JSON.stringify(logData, null, 2);
            }
        }

        dialogBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.id === 'jsHeightBtn') {
                    // Use JavaScript to set height based on visualViewport
                    useJsHeight = true;
                    currentHeightUnit = 'JS';
                    if (window.visualViewport) {
                        dialog.style.height = `${window.visualViewport.height}px`;
                    }
                } else {
                    // Use CSS units
                    useJsHeight = false;
                    currentHeightUnit = btn.dataset.heightUnit;
                    dialog.style.height = `100${currentHeightUnit}`;
                }
                dialog.classList.add('open');
                dialogOpen = true;
                updateAppHeight();
            });
        });

        dialog.addEventListener('click', (e) => {
            if (e.target === dialog) {
                dialog.classList.remove('open');
                dialogOpen = false;
                useJsHeight = false;
                dialog.style.height = '';
            }
        });

        // Update app height when visual viewport changes (e.g., keyboard opens/closes)
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', updateAppHeight);
            window.visualViewport.addEventListener('scroll', updateAppHeight);
        }
    </script>
</body>
</html>